---
import Layout from '$layouts/Layout.astro';
import Header from '$components/Header.astro';
import Footer from '$components/Footer.astro';
import VerticalNav from '$components/VerticalNav.svelte';
import VerticalList from '$components/VerticalList.svelte';
import json from '../app.json';


const {
  title,
  footer,
  states,
} = json;
---

<Layout title={title}>

  {states.map(s => {
    const {
      state,
      bannerNav,
      verticalNav,
      verticalList,
    } = s;
  <script>
    import { get } from 'svelte/store';
    import { stateCookie } from '$utils/stores';
    import { validateCookieValue, setLocalStateCookie, STATE_COOKIE_VALUE_WISCONSIN } from '$utils/stateCookie';

    // ensure LOCAL_STATE_COOKIE_KEY is always set
    // fallback to default Wisconsin value
    const initial = get(stateCookie);
    setLocalStateCookie( validateCookieValue(initial) ? initial : STATE_COOKIE_VALUE_WISCONSIN );

    // track page view
    const _paq = typeof window !== 'undefined' && window._paq || [];
    _paq.push(['trackPageView', stateCookie]);
  </script>

    return (
      <StateCookieProvider state={state} client:load>
        <div class="flex flex-v flex-wrap">

          <Header bannerNav={bannerNav} state={state} />

          <div class="flex vh-6-10" style="z-index:1;">
            <div class="wrap pad_b_2 smalls_pad_h_half">
              <div class="row">

                <VerticalNav {...verticalNav} client:load />

                <VerticalList {...verticalList} client:load />

              </div>
            </div>
          </div>
        </div>
    );
  })}

  <Footer footer={footer} />

</Layout>
